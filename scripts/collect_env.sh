#!/bin/bash

# Скрипт сбора характеристик среды выполнения
# Выводит информацию об ОС, CPU, RAM и диске в консоль

echo "================================"
echo "  BENCHMARK ОТЧЕТ"
echo "================================"
echo ""
echo "### [1] ХАРАКТЕРИСТИКИ СРЕДЫ"
echo ""

# Информация об операционной системе

# /etc/os-release - стандартный файл с информацией о дистрибутиве Linux
echo "Операционная система:"
if [ -f /etc/os-release ]; then
    source /etc/os-release
    echo "  Дистрибутив: $NAME $VERSION"
fi

# uname - выводит информацию о системе
#   -r - версия ядра (release)
#   -m - архитектура процессора (machine)
echo "  Kernel: $(uname -r)"
echo "  Архитектура: $(uname -m)"
echo ""

# Информация о процессоре

# lscpu - подробная информация о CPU
# Пайплайн: lscpu | grep "Model name" | cut -d: -f2 | xargs
#   grep "Model name" - ищем строку с названием модели
#   cut -d: -f2 - разделитель двоеточие, берем второе поле (после :)
#   xargs - убирает лишние пробелы в начале и конце строки
echo "Процессор:"
CPU_MODEL=$(lscpu | grep "Model name" | cut -d: -f2 | xargs)

# nproc - выводит количество доступных процессоров/ядер
CPU_CORES=$(nproc)

# awk '{print $2}' - выводит второе поле строки (разделитель - пробелы)
# ^CPU(s): - регулярка: строка начинается с "CPU(s):"
CPU_THREADS=$(lscpu | grep "^CPU(s):" | awk '{print $2}')

echo "  Модель: $CPU_MODEL"
echo "  Физических ядер: $CPU_CORES"
echo "  Потоков: $CPU_THREADS"
echo ""

# Информация об оперативной памяти

# free - информация об оперативной памяти
#   -h - человекочитаемый формат
#
# awk '/^Mem:/' - ищем строку, начинающуюся с "Mem:"
# Колонки free: total used free shared buff/cache available
#   $2 - всего памяти
#   $7 - доступно
echo "Оперативная память:"
free -h | awk '/^Mem:/ {printf "  Всего: %s\n  Доступно: %s\n", $2, $7}'
echo ""

# Информация о дисковом пространстве

# df - disk free, информация о файловых системах
#   / - показать только корневую файловую систему
#
# tail -n1 - берем последнюю строку (первая - заголовок)
#
# Колонки df: Filesystem Size Used Avail Use% Mounted
#   $2 - всего 
#   $3 - использовано 
#   $4 - свободно 
#   $5 - процент использования 
echo "Дисковое пространство:"
df -h / | tail -n1 | awk '{printf "  Всего: %s\n  Использовано: %s (%s)\n  Доступно: %s\n", $2, $3, $5, $4}'
echo ""
